{% extends "base.html" %}

{% if business_item %}
    {% block title %}{{business_item.name}}{% endblock %}
    
    {% block page_name %}{{business_item.name}}{% endblock %}

    {% block content %}
    
    <div class="span-12" id="business_props">
        <h2>Address</h2>
        <ul class="boxed_list">
            <li>{{business_item.address1}}<br/>
                {{ business_item.address2 }}<br/>
                {{ business_item.city }}, {{ business_item.province }}, {{ business_item.country }}<br/>
                {{ business_item.zipcode }}<br/>
            </li>
        </ul>
        <h2>Contact Number</h2>
        <ul class="boxed_list">
        {% for phone in phone_list %}
            <li>{{phone.phone_number}}</li>
        {% endfor %}
        </ul>
        
        <div class="buttons">
            <a href="/review/add/{{business_item.id}}" class="button"><img src="/images/icons/add.png" alt=""/> <span>Add Review</span></a> 
            <a href="/review/add/{{business_item.id}}" class="button"><img src="/images/icons/image_add.png" alt=""/> <span>Add Photos</span></a> 
        </div>
        <h2>Reviews</h2>
        <ul class="boxed_list">
        {% for review in reviews %}
            <li>{{review.review}} ({{review.created_at}})</li>
        {% endfor %}
        </ul>
    </div>
    
    <div class="span-12 last ">
        <div id="map_canvas" style="width: 475px; height: 300px"></div>
        <div id="map_message"></div>
        <div id="searchwell"></div> 
        <script type="text/javascript">
        //<![CDATA[
        $(document).ready(function() {
            // do stuff when DOM is ready
            var geocoder = new google.maps.Geocoder();
            var address = '{{string_location}}';
            var map;
            var geocoder = new google.maps.Geocoder();
            var map;
        
            // Our global state for LocalSearch
            var gInfoWindow;
            var gSelectedResults = [];
            var gCurrentResults = [];
            var gLocalSearch = new GlocalSearch();
        
            if (geocoder) {
                geocoder.geocode({ 'address': address }, function (results, status) {
                    if (status == google.maps.GeocoderStatus.OK) {
                        //alert(results[0].geometry.location.lat())
                        //alert(results[0].geometry.location.lng())
        
                        //Create the Map and center to geocode results latlong
                        var latlng = new google.maps.LatLng(results[0].geometry.location.lat(), results[0].geometry.location.lng());
                        var myOptions = {
                            zoom: 14,
                            center: latlng,
                            mapTypeId: google.maps.MapTypeId.ROADMAP
                        };
        
                        map = new google.maps.Map(document.getElementById("map_canvas"),
                            myOptions);
        
                        gLocalSearch.setSearchCompleteCallback(this, OnLocalSearch);
                        //gLocalSearch.execute("debra heights wesleyan church");
                        gLocalSearch.execute("{{business_item.name}}");
                    } 
                    else {
                        alert('No results found. Check console.log()');
                        console.log("Geocoding address: " + address);
                        console.log("Geocoding failed: " + status);
                    }
                });
            }
        
            /*
            Other functions        
            */        
            function OnLocalSearch() {
                if (gLocalSearch.results[0]) { //This is empty. Why?
                    var resultLat = gLocalSearch.results[0].lat; 
                    var resultLng = gLocalSearch.results[0].lng; 
                    var point = new google.maps.LatLng(resultLat,resultLng); 
                    callbackFunction(point); 
                }else{ 
                    alert("not found!"); 
                } 
            }
        });
        //]]>
        </script>
        
    </div>
    
    {% endblock %}
{% else %}
    No business available.
{% endif %} 